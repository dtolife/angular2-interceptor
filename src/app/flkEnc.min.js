var flkEnc=function(){function t(t){var e={};return _.each(["mk_key","sym_key"],function(i){t[i]&&(e[i]=t[i])}),_.each(["sign","decrypt"],function(i){t[i]&&(e[i]=r.serialize_private(t[i]))}),e}function e(t){var e={};return _.each(["encrypt","verify"],function(i){t[i]&&(e[i]=r.serialize_public(t[i]))}),e}var i={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};"undefined"!=typeof module&&module.exports&&(module.exports=i),i.cipher.aes=function(t){this._tables[0][0][0]||this._precompute();var e,r,n,s,o,c=this._tables[0][4],a=this._tables[1],h=t.length,u=1;if(4!==h&&6!==h&&8!==h)throw new i.exception.invalid("invalid aes key size");for(this._key=[s=t.slice(0),o=[]],e=h;e<4*h+28;e++)n=s[e-1],(e%h==0||8===h&&e%h==4)&&(n=c[n>>>24]<<24^c[n>>16&255]<<16^c[n>>8&255]<<8^c[255&n],e%h==0&&(n=n<<8^n>>>24^u<<24,u=u<<1^283*(u>>7))),s[e]=s[e-h]^n;for(r=0;e;r++,e--)n=s[3&r?e:e-4],o[r]=e<=4||r<4?n:a[0][c[n>>>24]]^a[1][c[n>>16&255]]^a[2][c[n>>8&255]]^a[3][c[255&n]]},i.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var t,e,i,r,n,s,o,c,a=this._tables[0],h=this._tables[1],u=a[4],l=h[4],d=[],f=[];for(t=0;t<256;t++)f[(d[t]=t<<1^283*(t>>7))^t]=t;for(e=i=0;!u[e];e^=r||1,i=f[i]||1)for(s=(s=i^i<<1^i<<2^i<<3^i<<4)>>8^255&s^99,u[e]=s,l[s]=e,c=16843009*d[n=d[r=d[e]]]^65537*n^257*r^16843008*e,o=257*d[s]^16843008*s,t=0;t<4;t++)a[t][e]=o=o<<24^o>>>8,h[t][s]=c=c<<24^c>>>8;for(t=0;t<5;t++)a[t]=a[t].slice(0),h[t]=h[t].slice(0)},_crypt:function(t,e){if(4!==t.length)throw new i.exception.invalid("invalid aes block size");var r,n,s,o,c=this._key[e],a=t[0]^c[0],h=t[e?3:1]^c[1],u=t[2]^c[2],l=t[e?1:3]^c[3],d=c.length/4-2,f=4,p=[0,0,0,0],m=this._tables[e],b=m[0],y=m[1],g=m[2],v=m[3],_=m[4];for(o=0;o<d;o++)r=b[a>>>24]^y[h>>16&255]^g[u>>8&255]^v[255&l]^c[f],n=b[h>>>24]^y[u>>16&255]^g[l>>8&255]^v[255&a]^c[f+1],s=b[u>>>24]^y[l>>16&255]^g[a>>8&255]^v[255&h]^c[f+2],l=b[l>>>24]^y[a>>16&255]^g[h>>8&255]^v[255&u]^c[f+3],f+=4,a=r,h=n,u=s;for(o=0;o<4;o++)p[e?3&-o:o]=_[a>>>24]<<24^_[h>>16&255]<<16^_[u>>8&255]<<8^_[255&l]^c[f++],r=a,a=h,h=u,u=l,l=r;return p}},i.bitArray={bitSlice:function(t,e,r){return t=i.bitArray._shiftRight(t.slice(e/32),32-(31&e)).slice(1),void 0===r?t:i.bitArray.clamp(t,r-e)},extract:function(t,e,i){var r=Math.floor(-e-i&31);return(-32&(e+i-1^e)?t[e/32|0]<<32-r^t[e/32+1|0]>>>r:t[e/32|0]>>>r)&(1<<i)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var r=t[t.length-1],n=i.bitArray.getPartial(r);return 32===n?t.concat(e):i.bitArray._shiftRight(e,n,0|r,t.slice(0,t.length-1))},bitLength:function(t){var e,r=t.length;return 0===r?0:(e=t[r-1],32*(r-1)+i.bitArray.getPartial(e))},clamp:function(t,e){if(32*t.length<e)return t;var r=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,r>0&&e&&(t[r-1]=i.bitArray.partial(e,t[r-1]&2147483648>>e-1,1)),t},partial:function(t,e,i){return 32===t?e:(i?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(i.bitArray.bitLength(t)!==i.bitArray.bitLength(e))return!1;var r,n=0;for(r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n},_shiftRight:function(t,e,r,n){var s,o,c=0;for(void 0===n&&(n=[]);e>=32;e-=32)n.push(r),r=0;if(0===e)return n.concat(t);for(s=0;s<t.length;s++)n.push(r|t[s]>>>e),r=t[s]<<32-e;return c=t.length?t[t.length-1]:0,o=i.bitArray.getPartial(c),n.push(i.bitArray.partial(e+o&31,e+o>32?r:n.pop(),1)),n},_xor4:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},i.codec.utf8String={fromBits:function(t){var e,r,n="",s=i.bitArray.bitLength(t);for(e=0;e<s/8;e++)0==(3&e)&&(r=t[e/4]),n+=String.fromCharCode(r>>>24),r<<=8;return decodeURIComponent(escape(n))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,r=[],n=0;for(e=0;e<t.length;e++)n=n<<8|t.charCodeAt(e),3==(3&e)&&(r.push(n),n=0);return 3&e&&r.push(i.bitArray.partial(8*(3&e),n)),r}},i.codec.hex={fromBits:function(t){var e,r="";for(e=0;e<t.length;e++)r+=(0xf00000000000+(0|t[e])).toString(16).substr(4);return r.substr(0,i.bitArray.bitLength(t)/4)},toBits:function(t){var e,r,n=[];for(r=(t=t.replace(/\s|0x/g,"")).length,t+="00000000",e=0;e<t.length;e+=8)n.push(0^parseInt(t.substr(e,8),16));return i.bitArray.clamp(n,4*r)}},i.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,r){var n,s="",o=0,c=i.codec.base64._chars,a=0,h=i.bitArray.bitLength(t);for(r&&(c=c.substr(0,62)+"-_"),n=0;6*s.length<h;)s+=c.charAt((a^t[n]>>>o)>>>26),o<6?(a=t[n]<<6-o,o+=26,n++):(a<<=6,o-=6);for(;3&s.length&&!e;)s+="=";return s},toBits:function(t,e){t=t.replace(/\s|=/g,"");var r,n,s=[],o=0,c=i.codec.base64._chars,a=0;for(e&&(c=c.substr(0,62)+"-_"),r=0;r<t.length;r++){if((n=c.indexOf(t.charAt(r)))<0)throw new i.exception.invalid("this isn't base64!");o>26?(o-=26,s.push(a^n>>>o),a=n<<32-o):a^=n<<32-(o+=6)}return 56&o&&s.push(i.bitArray.partial(56&o,a,1)),s}},i.codec.base64url={fromBits:function(t){return i.codec.base64.fromBits(t,1,1)},toBits:function(t){return i.codec.base64.toBits(t,1)}},i.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},i.hash.sha256.hash=function(t){return(new i.hash.sha256).update(t).finalize()},i.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=i.codec.utf8String.toBits(t));var e,r=this._buffer=i.bitArray.concat(this._buffer,t),n=this._length,s=this._length=n+i.bitArray.bitLength(t);for(e=512+n&-512;e<=s;e+=512)this._block(r.splice(0,16));return this},finalize:function(){var t,e=this._buffer,r=this._h;for(t=(e=i.bitArray.concat(e,[i.bitArray.partial(1,1)])).length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),r},_init:[],_key:[],_precompute:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,i=0,r=2;t:for(;i<64;r++){for(e=2;e*e<=r;e++)if(r%e==0)continue t;i<8&&(this._init[i]=t(Math.pow(r,.5))),this._key[i]=t(Math.pow(r,1/3)),i++}},_block:function(t){var e,i,r,n,s=t.slice(0),o=this._h,c=this._key,a=o[0],h=o[1],u=o[2],l=o[3],d=o[4],f=o[5],p=o[6],m=o[7];for(e=0;e<64;e++)e<16?i=s[e]:(r=s[e+1&15],n=s[e+14&15],i=s[15&e]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+s[15&e]+s[e+9&15]|0),i=i+m+(d>>>6^d>>>11^d>>>25^d<<26^d<<21^d<<7)+(p^d&(f^p))+c[e],m=p,p=f,f=d,d=l+i|0,l=u,u=h,a=i+((h=a)&u^l&(h^u))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10)|0;o[0]=o[0]+a|0,o[1]=o[1]+h|0,o[2]=o[2]+u|0,o[3]=o[3]+l|0,o[4]=o[4]+d|0,o[5]=o[5]+f|0,o[6]=o[6]+p|0,o[7]=o[7]+m|0}},i.mode.cbc={name:"cbc",encrypt:function(t,e,r){var n=i.codec.utf8String.toBits(t),s=new i.cipher.aes(n),o=i.codec.utf8String.toBits(e),c=i.codec.utf8String.toBits(r);if(128!==i.bitArray.bitLength(c))throw new i.exception.invalid("cbc iv must be 128 bits");var a,h=i.bitArray,u=h._xor4,l=h.bitLength(o),d=0,f=[];if(7&l)throw new i.exception.invalid("pkcs#5 padding only works for multiples of a byte");for(a=0;d+128<=l;a+=4,d+=128)c=s.encrypt(u(c,o.slice(a,a+4))),f.splice(a,0,c[0],c[1],c[2],c[3]);return l=16843009*(16-(l>>3&15)),c=s.encrypt(u(c,h.concat(o,[l,l,l,l]).slice(a,a+4))),f.splice(a,0,c[0],c[1],c[2],c[3]),i.codec.base64.fromBits(f)},decrypt:function(t,e,r){var n=i.codec.utf8String.toBits(t),s=new i.cipher.aes(n),o=i.codec.base64.toBits(e),c=i.codec.utf8String.toBits(r);if(128!==i.bitArray.bitLength(c))throw new i.exception.invalid("cbc iv must be 128 bits");if(127&i.bitArray.bitLength(o)||!o.length)throw new i.exception.corrupt("cbc ciphertext must be a positive multiple of the block size");var a,h,u,l=i.bitArray,d=l._xor4,f=[];for(a=0;a<o.length;a+=4)h=o.slice(a,a+4),u=d(c,s.decrypt(h)),f.splice(a,0,u[0],u[1],u[2],u[3]),c=h;if(0===(h=255&f[a-1])||h>16)throw new i.exception.corrupt("pkcs#5 padding corrupt");if(u=16843009*h,!l.equal(l.bitSlice([u,u,u,u],0,8*h),l.bitSlice(f,32*f.length-8*h,32*f.length)))throw new i.exception.corrupt("pkcs#5 padding corrupt");return i.codec.utf8String.fromBits(l.bitSlice(f,0,32*f.length-8*h))}},i.mode.ccm={name:"ccm",encrypt:function(t,e,r,n,s){var o,c,a=e.slice(0),h=i.bitArray,u=h.bitLength(r)/8,l=h.bitLength(a)/8;if(s=s||64,n=n||[],u<7)throw new i.exception.invalid("ccm: iv must be at least 7 bytes");for(o=2;o<4&&l>>>8*o;o++);return o<15-u&&(o=15-u),r=h.clamp(r,8*(15-o)),c=i.mode.ccm._computeTag(t,e,r,n,s,o),a=i.mode.ccm._ctrMode(t,a,r,c,s,o),h.concat(a.data,a.tag)},decrypt:function(t,e,r,n,s){s=s||64,n=n||[];var o,c,a=i.bitArray,h=a.bitLength(r)/8,u=a.bitLength(e),l=a.clamp(e,u-s),d=a.bitSlice(e,u-s);if(u=(u-s)/8,h<7)throw new i.exception.invalid("ccm: iv must be at least 7 bytes");for(o=2;o<4&&u>>>8*o;o++);if(o<15-h&&(o=15-h),r=a.clamp(r,8*(15-o)),l=i.mode.ccm._ctrMode(t,l,r,d,s,o),c=i.mode.ccm._computeTag(t,l.data,r,n,s,o),!a.equal(l.tag,c))throw new i.exception.corrupt("ccm: tag doesn't match");return l.data},_computeTag:function(t,e,r,n,s,o){var c,a,h,u=[],l=i.bitArray,d=l._xor4;if((s/=8)%2||s<4||s>16)throw new i.exception.invalid("ccm: invalid tag length");if(n.length>4294967295||e.length>4294967295)throw new i.exception.bug("ccm: can't deal with 4GiB or more data");if(c=[l.partial(8,(n.length?64:0)|s-2<<2|o-1)],c=l.concat(c,r),c[3]|=l.bitLength(e)/8,c=t.encrypt(c),n.length)for((a=l.bitLength(n)/8)<=65279?u=[l.partial(16,a)]:a<=4294967295&&(u=l.concat([l.partial(16,65534)],[a])),u=l.concat(u,n),h=0;h<u.length;h+=4)c=t.encrypt(d(c,u.slice(h,h+4).concat([0,0,0])));for(h=0;h<e.length;h+=4)c=t.encrypt(d(c,e.slice(h,h+4).concat([0,0,0])));return l.clamp(c,8*s)},_ctrMode:function(t,e,r,n,s,o){var c,a,h,u=i.bitArray,l=u._xor4,d=e.length,f=u.bitLength(e);if(h=u.concat([u.partial(8,o-1)],r).concat([0,0,0]).slice(0,4),n=u.bitSlice(l(n,t.encrypt(h)),0,s),!d)return{tag:n,data:[]};for(a=0;a<d;a+=4)h[3]++,c=t.encrypt(h),e[a]^=c[0],e[a+1]^=c[1],e[a+2]^=c[2],e[a+3]^=c[3];return{tag:n,data:u.clamp(e,f)}}},i.mode.ocb2={name:"ocb2",encrypt:function(t,e,r,n,s,o){if(128!==i.bitArray.bitLength(r))throw new i.exception.invalid("ocb iv must be 128 bits");var c,a,h,u,l=i.mode.ocb2._times2,d=i.bitArray,f=d._xor4,p=[0,0,0,0],m=l(t.encrypt(r)),b=[];for(n=n||[],s=s||64,c=0;c+4<e.length;c+=4)p=f(p,a=e.slice(c,c+4)),b=b.concat(f(m,t.encrypt(f(m,a)))),m=l(m);return a=e.slice(c),h=d.bitLength(a),u=t.encrypt(f(m,[0,0,0,h])),a=d.clamp(f(a.concat([0,0,0]),u),h),p=f(p,f(a.concat([0,0,0]),u)),p=t.encrypt(f(p,f(m,l(m)))),n.length&&(p=f(p,o?n:i.mode.ocb2.pmac(t,n))),b.concat(d.concat(a,d.clamp(p,s)))},decrypt:function(t,e,r,n,s,o){if(128!==i.bitArray.bitLength(r))throw new i.exception.invalid("ocb iv must be 128 bits");s=s||64;var c,a,h,u,l=i.mode.ocb2._times2,d=i.bitArray,f=d._xor4,p=[0,0,0,0],m=l(t.encrypt(r)),b=i.bitArray.bitLength(e)-s,y=[];for(n=n||[],c=0;c+4<b/32;c+=4)p=f(p,a=f(m,t.decrypt(f(m,e.slice(c,c+4))))),y=y.concat(a),m=l(m);if(h=b-32*c,u=t.encrypt(f(m,[0,0,0,h])),a=f(u,d.clamp(e.slice(c),h).concat([0,0,0])),p=f(p,a),p=t.encrypt(f(p,f(m,l(m)))),n.length&&(p=f(p,o?n:i.mode.ocb2.pmac(t,n))),!d.equal(d.clamp(p,s),d.bitSlice(e,b)))throw new i.exception.corrupt("ocb: tag doesn't match");return y.concat(d.clamp(a,h))},pmac:function(t,e){var r,n,s=i.mode.ocb2._times2,o=i.bitArray,c=o._xor4,a=[0,0,0,0],h=t.encrypt([0,0,0,0]);for(h=c(h,s(s(h))),r=0;r+4<e.length;r+=4)h=s(h),a=c(a,t.encrypt(c(h,e.slice(r,r+4))));return n=e.slice(r),o.bitLength(n)<128&&(h=c(h,s(h)),n=o.concat(n,[-2147483648,0,0,0])),a=c(a,n),t.encrypt(c(s(c(h,s(h))),a))},_times2:function(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}},i.misc.hmac=function(t,e){this._hash=e=e||i.hash.sha256;var r,n=[[],[]],s=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],t.length>s&&(t=e.hash(t)),r=0;r<s;r++)n[0][r]=909522486^t[r],n[1][r]=1549556828^t[r];this._baseHash[0].update(n[0]),this._baseHash[1].update(n[1])},i.misc.hmac.prototype.encrypt=i.misc.hmac.prototype.mac=function(t,e){var i=new this._hash(this._baseHash[0]).update(t,e).finalize();return new this._hash(this._baseHash[1]).update(i).finalize()},i.misc.pbkdf2=function(t,e,r,n,s){if(r=r||1e3,n<0||r<0)throw i.exception.invalid("invalid params to pbkdf2");"string"==typeof t&&(t=i.codec.utf8String.toBits(t));var o,c,a,h,u,l=new(s=s||i.misc.hmac)(t),d=[],f=i.bitArray;for(u=1;32*d.length<(n||1);u++){for(o=c=l.encrypt(f.concat(e,[u])),a=1;a<r;a++)for(c=l.encrypt(c),h=0;h<c.length;h++)o[h]^=c[h];d=d.concat(o)}return n&&(d=f.clamp(d,n)),d},i.random={randomWords:function(t,e){var r,n,s=[],o=this.isReady(e);if(0===o)throw new i.exception.notReady("generator isn't seeded");for(2&o&&this._reseedFromPools(!(1&o)),r=0;r<t;r+=4)(r+1)%65536==0&&this._gate(),n=this._gen4words(),s.push(n[0],n[1],n[2],n[3]);return this._gate(),s.slice(0,t)},setDefaultParanoia:function(t){this._defaultParanoia=t},addEntropy:function(t,e,r){r=r||"user";var n,s,o,c=0,a=(new Date).valueOf(),h=this._robins[r],u=this.isReady();switch(void 0===(n=this._collectorIds[r])&&(n=this._collectorIds[r]=this._collectorIdNext++),void 0===h&&(h=this._robins[r]=0),this._robins[r]=(this._robins[r]+1)%this._pools.length,typeof t){case"number":t=[t],c=1;break;case"object":if(void 0===e)for(e=0,s=0;s<t.length;s++)for(o=t[s];o>0;)e++,o>>>=1;this._pools[h].update([n,this._eventId++,c||2,e,a,t.length].concat(t));break;case"string":void 0===e&&(e=t.length),this._pools[h].update([n,this._eventId++,3,e,a,t.length]),this._pools[h].update(t);break;default:throw new i.exception.bug("random: addEntropy only supports number, array or string")}this._poolEntropy[h]+=e,this._poolStrength+=e,0===u&&(0!==this.isReady()&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(t){var e=this._PARANOIA_LEVELS[void 0!==t?t:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>80&&(new Date).valueOf()>this._nextReseed?3:1:this._poolStrength>=e?2:0},getProgress:function(t){var e=this._PARANOIA_LEVELS[t||this._defaultParanoia];return this._strength>=e?1:this._poolStrength>e?1:this._poolStrength/e},startCollectors:function(){if(!this._collectorsStarted){if(window.addEventListener)window.addEventListener("load",this._loadTimeCollector,!1),window.addEventListener("mousemove",this._mouseCollector,!1);else{if(!document.attachEvent)throw new i.exception.bug("can't attach event");document.attachEvent("onload",this._loadTimeCollector),document.attachEvent("onmousemove",this._mouseCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._loadTimeCollector,!1),window.removeEventListener("mousemove",this._mouseCollector,!1)):window.detachEvent&&(window.detachEvent("onload",this._loadTimeCollector),window.detachEvent("onmousemove",this._mouseCollector)),this._collectorsStarted=!1)},addEventListener:function(t,e){this._callbacks[t][this._callbackI++]=e},removeEventListener:function(t,e){var i,r,n=this._callbacks[t],s=[];for(r in n)n.hasOwnProperty(r)&&n[r]===e&&s.push(r);for(i=0;i<s.length;i++)delete n[r=s[i]]},_pools:[new i.hash.sha256],_poolEntropy:[0],_reseedCount:0,_robins:{},_eventId:0,_collectorIds:{},_collectorIdNext:0,_strength:0,_poolStrength:0,_nextReseed:0,_key:[0,0,0,0,0,0,0,0],_counter:[0,0,0,0],_cipher:void 0,_defaultParanoia:6,_collectorsStarted:!1,_callbacks:{progress:{},seeded:{}},_callbackI:0,_PARANOIA_LEVELS:[0,48,64,96,128,192,256,384,512,768,1024],_gen4words:function(){for(var t=0;t<4&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new i.cipher.aes(this._key)},_reseed:function(t){this._key=i.hash.sha256.hash(this._key.concat(t)),this._cipher=new i.cipher.aes(this._key);for(var e=0;e<4&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},_reseedFromPools:function(t){var e,r=[],n=0;for(this._nextReseed=r[0]=(new Date).valueOf()+3e4,e=0;e<16;e++)r.push(4294967296*Math.random()|0);for(e=0;e<this._pools.length&&(r=r.concat(this._pools[e].finalize()),n+=this._poolEntropy[e],this._poolEntropy[e]=0,t||!(this._reseedCount&1<<e));e++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new i.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=n,n>this._strength&&(this._strength=n),this._reseedCount++,this._reseed(r)},_mouseCollector:function(t){var e=t.x||t.clientX||t.offsetX,r=t.y||t.clientY||t.offsetY;i.random.addEntropy([e,r],2,"mouse")},_loadTimeCollector:function(t){var e=new Date;i.random.addEntropy(e,2,"loadtime")},_fireEvent:function(t,e){var r,n=i.random._callbacks[t],s=[];for(r in n)n.hasOwnProperty(r)&&s.push(n[r]);for(r=0;r<s.length;r++)s[r](e)}},function(){if("undefined"!=typeof crypto&&crypto&&crypto.getRandomValues){var t=new Uint32Array(32);crypto.getRandomValues(t),i.random.addEntropy(t,1024,"crypto.getRandomValues")}else{var e=Npm.require("crypto");if(e){var r=e.randomBytes(128);i.random.addEntropy(r,1024,"crypto.randomBytes")}}}(),i.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(t,e,r,n){r=r||{},n=n||{};var s,o,c,a=i.json,h=a._add({iv:i.random.randomWords(4,0)},a.defaults);if(a._add(h,r),c=h.adata,"string"==typeof h.salt&&(h.salt=i.codec.base64.toBits(h.salt)),"string"==typeof h.iv&&(h.iv=i.codec.base64.toBits(h.iv)),!i.mode[h.mode]||!i.cipher[h.cipher]||"string"==typeof t&&h.iter<=100||64!==h.ts&&96!==h.ts&&128!==h.ts||128!==h.ks&&192!==h.ks&&256!==h.ks||h.iv.length<2||h.iv.length>4)throw new i.exception.invalid("json encrypt: invalid parameters");return"string"==typeof t?(t=(s=i.misc.cachedPbkdf2(t,h)).key.slice(0,h.ks/32),h.salt=s.salt):i.ecc&&t instanceof i.ecc.elGamal.publicKey&&(s=t.kem(),h.kemtag=s.tag,t=s.key.slice(0,h.ks/32)),"string"==typeof e&&(e=i.codec.utf8String.toBits(e)),"string"==typeof c&&(c=i.codec.utf8String.toBits(c)),o=new i.cipher[h.cipher](t),a._add(n,h),n.key=t,h.ct=i.mode[h.mode].encrypt(o,e,h.iv,c,h.ts),a.encode(h)},decrypt:function(t,e,r,n){r=r||{},n=n||{};var s,o,c,a=i.json,h=a._add(a._add(a._add({},a.defaults),a.decode(e)),r,!0),u=h.adata;if("string"==typeof h.salt&&(h.salt=i.codec.base64.toBits(h.salt)),"string"==typeof h.iv&&(h.iv=i.codec.base64.toBits(h.iv)),!i.mode[h.mode]||!i.cipher[h.cipher]||"string"==typeof t&&h.iter<=100||64!==h.ts&&96!==h.ts&&128!==h.ts||128!==h.ks&&192!==h.ks&&256!==h.ks||!h.iv||h.iv.length<2||h.iv.length>4)throw new i.exception.invalid("json decrypt: invalid parameters");return"string"==typeof t?(t=(o=i.misc.cachedPbkdf2(t,h)).key.slice(0,h.ks/32),h.salt=o.salt):i.ecc&&t instanceof i.ecc.elGamal.secretKey&&(t=t.unkem(i.codec.base64.toBits(h.kemtag)).slice(0,h.ks/32)),"string"==typeof u&&(u=i.codec.utf8String.toBits(u)),c=new i.cipher[h.cipher](t),s=i.mode[h.mode].decrypt(c,h.ct,h.iv,u,h.ts),a._add(n,h),n.key=t,i.codec.utf8String.fromBits(s)},encode:function(t){var e,r="{",n="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new i.exception.invalid("json encode: invalid property name");switch(r+=n+'"'+e+'":',n=",",typeof t[e]){case"number":case"boolean":r+=t[e];break;case"string":r+='"'+escape(t[e])+'"';break;case"object":r+='"'+i.codec.base64.fromBits(t[e],1)+'"';break;default:throw new i.exception.bug("json encode: unsupported type")}}return r+"}"},decode:function(t){if(!(t=t.replace(/\s/g,"")).match(/^\{.*\}$/))throw new i.exception.invalid("json decode: this isn't json!");var e,r,n=t.replace(/^\{|\}$/g,"").split(/,/),s={};for(e=0;e<n.length;e++){if(!(r=n[e].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new i.exception.invalid("json decode: this isn't json!");r[3]?s[r[2]]=parseInt(r[3],10):s[r[2]]=r[2].match(/^(ct|salt|iv)$/)?i.codec.base64.toBits(r[4]):unescape(r[4])}return s},_add:function(t,e,r){if(void 0===t&&(t={}),void 0===e)return t;var n;for(n in e)if(e.hasOwnProperty(n)){if(r&&void 0!==t[n]&&t[n]!==e[n])throw new i.exception.invalid("required parameter overridden");t[n]=e[n]}return t},_subtract:function(t,e){var i,r={};for(i in t)t.hasOwnProperty(i)&&t[i]!==e[i]&&(r[i]=t[i]);return r},_filter:function(t,e){var i,r={};for(i=0;i<e.length;i++)void 0!==t[e[i]]&&(r[e[i]]=t[e[i]]);return r}},i.encrypt=i.json.encrypt,i.decrypt=i.json.decrypt,i.misc._pbkdf2Cache={},i.misc.cachedPbkdf2=function(t,e){var r,n,s,o,c=i.misc._pbkdf2Cache;return e=e||{},o=e.iter||1e3,n=c[t]=c[t]||{},r=n[o]=n[o]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):i.random.randomWords(2,0)},s=void 0===e.salt?r.firstSalt:e.salt,r[s]=r[s]||i.misc.pbkdf2(t,s,e.iter),{key:r[s].slice(0),salt:s.slice(0)}},i.bn=function(t){this.initWith(t)},i.bn.prototype={radix:24,maxMul:8,_class:i.bn,copy:function(){return new this._class(this)},initWith:function(t){var e,i=0;switch(typeof t){case"object":this.limbs=t.limbs.slice(0);break;case"number":this.limbs=[t],this.normalize();break;case"string":for(t=t.replace(/^0x/,""),this.limbs=[],e=this.radix/4,i=0;i<t.length;i+=e)this.limbs.push(parseInt(t.substring(Math.max(t.length-i-e,0),t.length-i),16));break;default:this.limbs=[0]}return this},equals:function(t){"number"==typeof t&&(t=new this._class(t));var e,i=0;for(this.fullReduce(),t.fullReduce(),e=0;e<this.limbs.length||e<t.limbs.length;e++)i|=this.getLimb(e)^t.getLimb(e);return 0===i},getLimb:function(t){return t>=this.limbs.length?0:this.limbs[t]},greaterEquals:function(t){"number"==typeof t&&(t=new this._class(t));var e,i,r,n=0,s=0;for(e=Math.max(this.limbs.length,t.limbs.length)-1;e>=0;e--)n|=(i=this.getLimb(e))-(r=t.getLimb(e))&~(s|=r-i&~n);return(s|~n)>>>31},toString:function(){this.fullReduce();var t,e,i="",r=this.limbs;for(t=0;t<this.limbs.length;t++){for(e=r[t].toString(16);t<this.limbs.length-1&&e.length<6;)e="0"+e;i=e+i}return"0x"+i},addM:function(t){"object"!=typeof t&&(t=new this._class(t));var e,i=this.limbs,r=t.limbs;for(e=i.length;e<r.length;e++)i[e]=0;for(e=0;e<r.length;e++)i[e]+=r[e];return this},doubleM:function(){var t,e,i=0,r=this.radix,n=this.radixMask,s=this.limbs;for(t=0;t<s.length;t++)e=(e=s[t])+e+i,s[t]=e&n,i=e>>r;return i&&s.push(i),this},halveM:function(){var t,e,i=0,r=this.radix,n=this.limbs;for(t=n.length-1;t>=0;t--)e=n[t],n[t]=e+i>>1,i=(1&e)<<r;return n[n.length-1]||n.pop(),this},subM:function(t){"object"!=typeof t&&(t=new this._class(t));var e,i=this.limbs,r=t.limbs;for(e=i.length;e<r.length;e++)i[e]=0;for(e=0;e<r.length;e++)i[e]-=r[e];return this},mod:function(t){t=new i.bn(t).normalize();for(var e=new i.bn(this).normalize(),r=0;e.greaterEquals(t);r++)t.doubleM();for(;r>0;r--)t.halveM(),e.greaterEquals(t)&&e.subM(t).normalize();return e.trim()},inverseMod:function(t){var e,r,n=new i.bn(1),s=new i.bn(0),o=new i.bn(this),c=new i.bn(t),a=1;if(!(1&t.limbs[0]))throw new i.exception.invalid("inverseMod: p must be odd");do{for(1&o.limbs[0]&&(o.greaterEquals(c)||(e=o,o=c,c=e,e=n,n=s,s=e),o.subM(c),o.normalize(),n.greaterEquals(s)||n.addM(t),n.subM(s)),o.halveM(),1&n.limbs[0]&&n.addM(t),n.normalize(),n.halveM(),r=a=0;r<o.limbs.length;r++)a|=o.limbs[r]}while(a);if(!c.equals(1))throw new i.exception.invalid("inverseMod: p and x must be relatively prime");return s},add:function(t){return this.copy().addM(t)},sub:function(t){return this.copy().subM(t)},mul:function(t){"number"==typeof t&&(t=new this._class(t));var e,i,r,n=this.limbs,s=t.limbs,o=n.length,c=s.length,a=new this._class,h=a.limbs,u=this.maxMul;for(e=0;e<this.limbs.length+t.limbs.length+1;e++)h[e]=0;for(e=0;e<o;e++){for(r=n[e],i=0;i<c;i++)h[e+i]+=r*s[i];--u||(u=this.maxMul,a.cnormalize())}return a.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(t){"number"==typeof t?t=[t]:void 0!==t.limbs&&(t=t.normalize().limbs);var e,i,r=new this._class(1),n=this;for(e=0;e<t.length;e++)for(i=0;i<this.radix;i++)t[e]&1<<i&&(r=r.mul(n)),n=n.square();return r},mulmod:function(t,e){return this.mod(e).mul(t.mod(e)).mod(e)},powermod:function(t,e){for(var r=new i.bn(1),n=new i.bn(this),s=new i.bn(t);;){if(1&s.limbs[0]&&(r=r.mulmod(n,e)),s.halveM(),s.equals(0))break;n=n.mulmod(n,e)}return r.normalize().reduce()},trim:function(){var t,e=this.limbs;do{t=e.pop()}while(e.length&&0===t);return e.push(t),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var t,e,i=0,r=(this.placeVal,this.ipv),n=this.limbs,s=n.length,o=this.radixMask;for(t=0;t<s||0!==i&&-1!==i;t++)i=((e=(n[t]||0)+i)-(n[t]=e&o))*r;return-1===i&&(n[t-1]-=this.placeVal),this},cnormalize:function(){var t,e,i=0,r=this.ipv,n=this.limbs,s=n.length,o=this.radixMask;for(t=0;t<s-1;t++)i=((e=n[t]+i)-(n[t]=e&o))*r;return n[t]+=i,this},toBits:function(t){this.fullReduce(),t=t||this.exponent||this.limbs.length*this.radix;var e=Math.floor((t-1)/24),r=i.bitArray,n=(t+7&-8)%this.radix||this.radix,s=[r.partial(n,this.getLimb(e))];for(e--;e>=0;e--)s=r.concat(s,[r.partial(this.radix,this.getLimb(e))]);return s},bitLength:function(){this.fullReduce();for(var t=this.radix*(this.limbs.length-1),e=this.limbs[this.limbs.length-1];e;e>>=1)t++;return t+7&-8}},i.bn.fromBits=function(t){var e=new this,r=[],n=i.bitArray,s=this.prototype,o=Math.min(this.bitLength||4294967296,n.bitLength(t)),c=o%s.radix||s.radix;for(r[0]=n.extract(t,0,c);c<o;c+=s.radix)r.unshift(n.extract(t,c,s.radix));return e.limbs=r,e},i.bn.prototype.ipv=1/(i.bn.prototype.placeVal=Math.pow(2,i.bn.prototype.radix)),i.bn.prototype.radixMask=(1<<i.bn.prototype.radix)-1,i.bn.pseudoMersennePrime=function(t,e){function r(t){this.initWith(t)}var n,s,o,c=r.prototype=new i.bn;for(o=c.modOffset=Math.ceil(s=t/c.radix),c.exponent=t,c.offset=[],c.factor=[],c.minOffset=o,c.fullMask=0,c.fullOffset=[],c.fullFactor=[],c.modulus=r.modulus=new i.bn(Math.pow(2,t)),c.fullMask=0|-Math.pow(2,t%c.radix),n=0;n<e.length;n++)c.offset[n]=Math.floor(e[n][0]/c.radix-s),c.fullOffset[n]=Math.ceil(e[n][0]/c.radix-s),c.factor[n]=e[n][1]*Math.pow(.5,t-e[n][0]+c.offset[n]*c.radix),c.fullFactor[n]=e[n][1]*Math.pow(.5,t-e[n][0]+c.fullOffset[n]*c.radix),c.modulus.addM(new i.bn(Math.pow(2,e[n][0])*e[n][1])),c.minOffset=Math.min(c.minOffset,-c.offset[n]);return c._class=r,c.modulus.cnormalize(),c.reduce=function(){var t,e,i,r,n=this.modOffset,s=this.limbs,o=this.offset,c=this.offset.length,a=this.factor;for(t=this.minOffset;s.length>n;){for(i=s.pop(),r=s.length,e=0;e<c;e++)s[r+o[e]]-=a[e]*i;--t||(s.push(0),this.cnormalize(),t=this.minOffset)}return this.cnormalize(),this},c._strongReduce=-1===c.fullMask?c.reduce:function(){var t,e,i=this.limbs,r=i.length-1;if(this.reduce(),r===this.modOffset-1){for(e=i[r]&this.fullMask,i[r]-=e,t=0;t<this.fullOffset.length;t++)i[r+this.fullOffset[t]]-=this.fullFactor[t]*e;this.normalize()}},c.fullReduce=function(){var t,e;for(this._strongReduce(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this._strongReduce(),e=this.limbs.length;e<this.modOffset;e++)this.limbs[e]=0;for(t=this.greaterEquals(this.modulus),e=0;e<this.limbs.length;e++)this.limbs[e]-=this.modulus.limbs[e]*t;return this.cnormalize(),this},c.inverse=function(){return this.power(this.modulus.sub(2))},r.fromBits=i.bn.fromBits,r},i.bn.prime={p127:i.bn.pseudoMersennePrime(127,[[0,-1]]),p25519:i.bn.pseudoMersennePrime(255,[[0,-19]]),p192:i.bn.pseudoMersennePrime(192,[[0,-1],[64,-1]]),p224:i.bn.pseudoMersennePrime(224,[[0,1],[96,-1]]),p256:i.bn.pseudoMersennePrime(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:i.bn.pseudoMersennePrime(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:i.bn.pseudoMersennePrime(521,[[0,-1]])},i.bn.random=function(t,e){"object"!=typeof t&&(t=new i.bn(t));for(var r,n,s=t.limbs.length,o=t.limbs[s-1]+1,c=new i.bn;;){do{(r=i.random.randomWords(s,e))[s-1]<0&&(r[s-1]+=4294967296)}while(Math.floor(r[s-1]/o)===Math.floor(4294967296/o));for(r[s-1]%=o,n=0;n<s-1;n++)r[n]&=t.radixMask;if(c.limbs=r,!c.greaterEquals(t))return c}},i.ecc={},i.ecc.point=function(t,e,i){void 0===e?this.isIdentity=!0:(this.x=e,this.y=i,this.isIdentity=!1),this.curve=t},i.ecc.point.prototype={toJac:function(){return new i.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(t){return this.toJac().mult(t,this).toAffine()},mult2:function(t,e,i){return this.toJac().mult2(t,this,e,i).toAffine()},multiples:function(){var t,e,r;if(void 0===this._multiples)for(r=this.toJac().doubl(),t=this._multiples=[new i.ecc.point(this.curve),this,r.toAffine()],e=3;e<16;e++)r=r.add(this),t.push(r.toAffine());return this._multiples},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return i.bitArray.concat(this.x.toBits(),this.y.toBits())}},i.ecc.pointJac=function(t,e,i,r){void 0===e?this.isIdentity=!0:(this.x=e,this.y=i,this.z=r,this.isIdentity=!1),this.curve=t},i.ecc.pointJac.prototype={add:function(t){var e,r,n,s,o,c,a,h,u,l,d,f=this;if(f.curve!==t.curve)throw"sjcl.ecc.add(): Points must be on the same curve to add them!";return f.isIdentity?t.toJac():t.isIdentity?f:(e=f.z.square(),(r=t.x.mul(e).subM(f.x)).equals(0)?f.y.equals(t.y.mul(e.mul(f.z)))?f.doubl():new i.ecc.pointJac(f.curve):(n=t.y.mul(e.mul(f.z)).subM(f.y),s=r.square(),o=n.square(),c=r.square().mul(r).addM(f.x.add(f.x).mul(s)),a=o.subM(c),h=f.x.mul(s).subM(a).mul(n),u=f.y.mul(r.square().mul(r)),l=h.subM(u),d=f.z.mul(r),new i.ecc.pointJac(this.curve,a,l,d)))},doubl:function(){if(this.isIdentity)return this;var t=this.y.square(),e=t.mul(this.x.mul(4)),r=t.square().mul(8),n=this.z.square(),s=this.x.sub(n).mul(3).mul(this.x.add(n)),o=s.square().subM(e).subM(e),c=e.sub(o).mul(s).subM(r),a=this.y.add(this.y).mul(this.z);return new i.ecc.pointJac(this.curve,o,c,a)},toAffine:function(){if(this.isIdentity||this.z.equals(0))return new i.ecc.point(this.curve);var t=this.z.inverse(),e=t.square();return new i.ecc.point(this.curve,this.x.mul(e).fullReduce(),this.y.mul(e.mul(t)).fullReduce())},mult:function(t,e){"number"==typeof t?t=[t]:void 0!==t.limbs&&(t=t.normalize().limbs);var r,n,s=new i.ecc.point(this.curve).toJac(),o=e.multiples();for(r=t.length-1;r>=0;r--)for(n=i.bn.prototype.radix-4;n>=0;n-=4)s=s.doubl().doubl().doubl().doubl().add(o[t[r]>>n&15]);return s},mult2:function(t,e,r,n){"number"==typeof t?t=[t]:void 0!==t.limbs&&(t=t.normalize().limbs),"number"==typeof r?r=[r]:void 0!==r.limbs&&(r=r.normalize().limbs);var s,o,c,a,h=new i.ecc.point(this.curve).toJac(),u=e.multiples(),l=n.multiples();for(s=Math.max(t.length,r.length)-1;s>=0;s--)for(c=0|t[s],a=0|r[s],o=i.bn.prototype.radix-4;o>=0;o-=4)h=h.doubl().doubl().doubl().doubl().add(u[c>>o&15]).add(l[a>>o&15]);return h},isValid:function(){var t=this.z.square(),e=t.square(),i=e.mul(t);return this.y.square().equals(this.curve.b.mul(i).add(this.x.mul(this.curve.a.mul(e).add(this.x.square()))))}},i.ecc.curve=function(t,e,r,n,s,o){this.field=t,this.r=t.prototype.modulus.sub(e),this.a=new t(r),this.b=new t(n),this.G=new i.ecc.point(this,new t(s),new t(o))},i.ecc.curve.prototype.fromBits=function(t){var e=i.bitArray,r=this.field.prototype.exponent+7&-8,n=new i.ecc.point(this,this.field.fromBits(e.bitSlice(t,0,r)),this.field.fromBits(e.bitSlice(t,r,2*r)));if(!n.isValid())throw new i.exception.corrupt("not on the curve!");return n},i.ecc.curves={c192:new i.ecc.curve(i.bn.prime.p192,"0x662107c8eb94364e4b2dd7ce",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new i.ecc.curve(i.bn.prime.p224,"0xe95c1f470fc1ec22d6baa3a3d5c4",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new i.ecc.curve(i.bn.prime.p256,"0x4319055358e8617b0c46353d039cdaae",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new i.ecc.curve(i.bn.prime.p384,"0x389cb27e0bc8d21fa7e5f24cb74f58851313e696333ad68c",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},i.ecc._dh=function(t){i.ecc[t]={publicKey:function(t,e){this._curve=t,e instanceof Array?this._point=t.fromBits(e):this._point=e},secretKey:function(t,e){this._curve=t,this._exponent=e},generateKeys:function(e,r){if(void 0===e&&(e=256),"number"==typeof e&&void 0===(e=i.ecc.curves["c"+e]))throw new i.exception.invalid("no such curve");var n=i.bn.random(e.r,r),s=e.G.mult(n);return{pub:new i.ecc[t].publicKey(e,s),sec:new i.ecc[t].secretKey(e,n)}}}},i.ecc._dh("elGamal"),i.ecc.elGamal.publicKey.prototype={kem:function(t){var e=i.bn.random(this._curve.r,t),r=this._curve.G.mult(e).toBits();return{key:i.hash.sha256.hash(this._point.mult(e).toBits()),tag:r}}},i.ecc.elGamal.secretKey.prototype={unkem:function(t){return i.hash.sha256.hash(this._curve.fromBits(t).mult(this._exponent).toBits())},dh:function(t){return i.hash.sha256.hash(t._point.mult(this._exponent).toBits())}},i.ecc._dh("ecdsa"),i.ecc.ecdsa.secretKey.prototype={sign:function(t,e){var r=this._curve.r,n=r.bitLength(),s=i.bn.random(r.sub(1),e).add(1),o=this._curve.G.mult(s).x.mod(r),c=i.bn.fromBits(t).add(o.mul(this._exponent)).inverseMod(r).mul(s).mod(r);return i.bitArray.concat(o.toBits(n),c.toBits(n))}},i.ecc.ecdsa.publicKey.prototype={verify:function(t,e){var r=i.bitArray,n=this._curve.r,s=n.bitLength(),o=i.bn.fromBits(r.bitSlice(e,0,s)),c=i.bn.fromBits(r.bitSlice(e,s,2*s)),a=i.bn.fromBits(t).mul(c).mod(n),h=o.mul(c).mod(n),u=this._curve.G.mult2(a,h,this._point).x;if(o.equals(0)||c.equals(0)||o.greaterEquals(n)||c.greaterEquals(n)||!u.equals(o))throw new i.exception.corrupt("signature didn't check out");return!0}};var r={serialize_public:function(t){return i.codec.hex.fromBits(t._point.toBits())},serialize_private:function(t){return i.codec.hex.fromBits(t._exponent.toBits())},deserialize_public:function(t,e){var r=i.ecc.curves.c192,n=r.fromBits(i.codec.hex.toBits(t));return new i.ecc[e].publicKey(r,n)},deserialize_private:function(t,e){var r=i.ecc.curves.c192,n=i.bn.fromBits(i.codec.hex.toBits(t));return new i.ecc[e].secretKey(r,n)},generate_keys:function(){var t=i.ecc.elGamal.generateKeys(192,0),e=i.ecc.ecdsa.generateKeys(192,0),r=i.random.randomWords(8);return{encrypt:t.pub,decrypt:t.sec,sign:e.sec,verify:e.pub,sym_key:r}},encrypt:function(t,e){return i.encrypt(t,e)},decrypt:function(t,e){return i.decrypt(t,e)},secret_derive:function(t,e){var r=JSON.stringify(t,e),n=i.hash.sha256.hash(r);return JSON.stringify(n)},sym_encrypt:function(t,e,r){void 0===e&&console.log("sym_encrypt: undefined",e);var n=i.mode.cbc.encrypt(t,e,"0000000000000000");return console.log("aes enc:"+n),n},sym_decrypt:function(t,e,r){void 0===e&&console.log("sym_decrypt: undefined",e);return i.mode.cbc.decrypt(t,e,"0000000000000000")},sign:function(t,e){var r=i.hash.sha256.hash(t);return e.sign(r)},verify:function(t,e,r){var n=i.hash.sha256.hash(t);try{return r.verify(n,e),!0}catch(t){return!1}},mkhash:function(t,e){var r=i.hash.sha256.hash(t+e),n=(e=i.codec.hex.fromBits(r)).length;return e.substr(n-10,10)},chain_decrypt:function(t,e){return _.each(t,function(t){var i;if(void 0==t.isSym||null==t.isSym)throw new Error("invalid wrapped key");i=t.isSym?r.sym_decrypt(e.sym_key,t.wkey):r.decrypt(e.decrypt,t.wkey),e=deserialize_keys(i)}),e},chain_verify:function(t){return t=_.map(t,function(t){var e=i.hash.sha256.hash(t.m),r=t.pk;try{return r.verify(e,t.sig),!0}catch(t){return!1}}),_.every(t,_.identity)}};return r.deserialize_keys=function(t){var e=EJSON.parse(t);return e.encrypt&&(e.encrypt=r.deserialize_public(e.encrypt,"elGamal")),e.decrypt&&(e.decrypt=r.deserialize_private(e.decrypt,"elGamal")),e.sign&&(e.sign=r.deserialize_private(e.sign,"ecdsa")),e.verify&&(e.verify=r.deserialize_public(e.verify,"ecdsa")),e},r.serialize_keys=function(i){var r=_.extend(t(i),e(i));return EJSON.stringify(r)},r.serialize_private=function(e){return EJSON.stringify(t(e))},r.serialize_public=function(t){return EJSON.stringify(e(t))},r.format_cert=function(t,e,i){return JSON.stringify({type:"user",email:t,pk:e,origin:i})},r}();